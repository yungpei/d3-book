<!DOCTYPE html>
<html>
<head>
	<title>chapter 06</title>
	<meta charset="utf-8">
  <link rel="stylesheet" href="index.css">

  <!--
  <script type="text/javascript" src="https://d3js.org/d3.v4.js"></script>
  <script type="text/javascript" src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
  -->
  <script type="text/javascript" src="../d3.js/d3.js"></script>
</head>
<body>
<!-- ---------------------- -->
  <!-- https://alexlenail.me/NN-SVG/about.html -->
  <a href="https://github.com/scotthmurray/d3-book/" class="github-corner" aria-label="View source on Github">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
      <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
      <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
      <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </svg>
  </a>
<!-- ---------------------- -->

<!-- ---------------------- -->
<h1>資料可視化</h1>
<h3>chapter 06 <hr> Drawing with Data</h3>

<!-- ---------------------- -->
<div>
  <a href="https://alignedleft.com/tutorials/d3/">D3 Tutorials</a><br>
  <a href="https://www.oreilly.com/library/view/interactive-data-visualization/9781491921296/">Interactive Data Visualization for the Web, 2nd Edition [Book]</a>, O’Reilly Media, Inc.<br>
  <a href="https://github.com/scotthmurray/d3-book/releases">Source Code</a><br>
  <hr>
  <textarea rows="16" cols="120">

<!DOCTYPE html>
<html lang="zh-Hant-TW">
    <head>
        <meta charset="utf-8">
        <title>D3 Page Template</title>
        <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    </head>
    <body>
        <script type="text/javascript">
            // Your beautiful D3 code will go here
        </script>
    </body>
</html>

  </textarea>
</div>
<!-- ---------------------- -->




<h3>畫資料</h3>

<p>
Simple dataset:</p>

<div>
  <textarea rows="6" cols="100">
var dataset = [ 5, 10, 15, 20, 25 ];
  </textarea>
</div>



<h3>Drawing divs</h3>
<p>
An HTML div is the easiest way to draw a rectangle. <br><br>
</p>

<!-- 
<p>
  Formally, a chart with vertically oriented rectangles is a <span style="color:red">column chart</span>, and one with
horizontal rectangles is a <span style="color:red">bar chart</span>. 

In practice, most people just call them all bar charts, as I’ll do from now on.
</p>
-->


<p>
This <span style="color:red">div</span> could work well as a <span style="color:red">data bar</span>, shown in Figure 6-1.
</p>

<div>
  <textarea rows="6" cols="120">
<div style="display: inline-block; <!-- 行內區塊: 可設定block寬高的屬性，但其排版仍像 inline 屬性(不會占滿整個容器)。 --> 
            width: 20px;
            height: 75px;
            background-color: teal;"></div>
  </textarea>
</div>

<div>
  <div style="display: inline-block;
  width: 20px;
  height: 75px;
  background-color: teal;"></div>
</div>

<!-- 
<p>
Among web standards folks, this is a semantic no-no. Normally, one shouldn’t use an
empty div for purely visual effect, but I am making an exception for the sake of this
example.
</p>
-->



<p>
Put those shared styles into a class called bar:
</p>
<div>
  <textarea rows="8" cols="100">
div.bar {
  display: inline-block;
  width: 20px;
  height: 75px; /* We'll override height later */
  background-color: teal;
}
  </textarea>
</div>


<p>
Now each <span style="color:red">div</span> needs to be assigned the <span style="color:red">bar class</span>. 


<!-- If you were writing the HTML code by hand, you would write the following: -->

</p>
<div>
  <textarea rows="3" cols="100">
<div class="bar"></div>
  </textarea>
</div>





<h3>Setting Attributes</h3>

<p><a href="https://github.com/d3/d3-selection/blob/master/README.md#selection_attr">
attr()</a>
</p>

<p>
To assign a class of bar:
</p>

<div>
  <textarea rows="3" cols="100">
.attr("class", "bar")
  </textarea>
</div>




<h3>A Note on Classes</h3>
<p>
<span style="color:red">classed()</span>, which can be used to
quickly <span style="color:red">apply or remove classes</span> from elements. <br><br>

上述程式碼，可以改寫如下:
</p>
<div>
  <textarea rows="3" cols="100">
.classed("bar", true)
  </textarea>
</div>


<p>

If <span style="color:red">false</span> were specified, removing the class of bar:
</p>
<div>
  <textarea rows="3" cols="100">
.classed("bar", false)
  </textarea>
</div>


<h3>Back to the Bars</h3>

<!-- ---------------------- -->
<div>
  D3: Drawing divs with data
  <div id="demo0601"></div>
  <hr>
  <button onclick="myFunction0601()">chapter_06/01_drawing_divs.html</button>
  <hr>
  <textarea rows="10" cols="100">

      var dataset = [ 5, 10, 15, 20, 25 ];
      
      d3.select("#demo0601").selectAll("div")
        .data(dataset)
        .enter()
        .append("div")
        .attr("class", "bar");
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0601() {
      var dataset = [ 5, 10, 15, 20, 25 ];
      
      d3.select("#demo0601").selectAll("div")
        .data(dataset)
        .enter()
        .append("div")
        .attr("class", "bar");
  }
</script>
<!-- ---------------------- -->




<h3>Setting Styles</h3>
<p>
The <a href="https://github.com/d3/d3-selection/blob/master/README.md#selection_style">style()</a> method is used to apply a CSS property and value. 

<br><br>
This is the equivalent of including CSS rules, as in:
</p>
<div>
  <textarea rows="3" cols="100">
<div style="height: 75px;"></div>
  </textarea>
</div>

<p>
Make the <span style="color:red">height</span> of each bar a function of its corresponding
<span style="color:red">data value</span>. 
</p>

<div>
  <textarea rows="6" cols="100">
.style("height", function(d) {
  return d + "px";
});
  </textarea>
</div>


<!-- ---------------------- -->
<div>
  D3: Setting div heights from data
  <div id="demo0602"></div>
  <hr>
  <button onclick="myFunction0602()">chapter_06/02_drawing_divs_height.html</button>
  <hr>
  <textarea rows="14" cols="100">

      var dataset = [ 5, 10, 15, 20, 25 ];
      
      d3.select("#demo0602")
        .selectAll("div")
        .data(dataset)
        .enter()
        .append("div")
        .attr("class", "bar")
        .style("height", function(d) {
          return d + "px";
        });
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0602() {
      var dataset = [ 5, 10, 15, 20, 25 ];
      
      d3.select("#demo0602")
        .selectAll("div")
        .data(dataset)
        .enter()
        .append("div")
        .attr("class", "bar")
        .style("height", function(d) {
          return d*2 + "px";
        });
      
  }
</script>
<!-- ---------------------- -->


<p>
When D3 loops through each data point, the value of <span style="color:red">d</span> will be set to that of the corresponding
value. <br><br>
<!--
So we are setting a height value of d (the current data value) while
appending the text px (to specify the units are pixels). 
-->
The resulting heights are <span style="color:red">5px</span>, <span style="color:red">10px</span>, <span style="color:red">15px</span>, <span style="color:red">20px</span>, and <span style="color:red">25px</span>.
</p>

<h3>03_drawing_divs_spaced.html</h3>


<p>
Make those bars taller:
</p>
<div>
  <textarea rows="6" cols="100">
.style("height", function(d) {
  var barHeight = d * 5; //Scale up by factor of 5
  return barHeight + "px";
});
  </textarea>
</div>



<p>
Add some space to the right of each bar (in the embedded CSS style):
</p>
<div>
  <textarea rows="3" cols="100">
margin-right: 2px;
  </textarea>
</div>


<!-- ---------------------- -->
<div>
  D3: Drawing divs, spaced out
  <div id="demo0603"></div>
  <hr>
  <button onclick="myFunction0603()">chapter_06/03_drawing_divs_spaced.html</button>
  <hr>
  <textarea rows="12" cols="100">

var dataset = [ 5, 10, 15, 20, 25 ];

d3.select("#demo0603").selectAll("div")
  .data(dataset)
  .enter()
  .append("div")
  .attr("class", "bar2")
  .style("height", function(d) {
    return d + "px";
  });
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0603() {
      var dataset = [ 5, 10, 15, 20, 25 ];
      
      d3.select("#demo0603").selectAll("div")
        .data(dataset)
        .enter()
        .append("div")
        .attr("class", "bar2")
        .style("height", function(d) {
          var barHeight = d * 5;
          return barHeight + "px";
        });
      
  }
</script>
<!-- ---------------------- -->




<h3>The Power of data()</h3>

<div>
  <textarea rows="3" cols="100">
var dataset = [ 5, 10, 15, 20, 25 ];
  </textarea>
</div>

<!-- ---------------------- -->
<div>
  D3: Our first bar chart with data
  <div id="demo0604"></div>
  <hr>
  <button onclick="myFunction0604()">chapter_06/04_power_of_data.html</button>
  <hr>
  <textarea rows="14" cols="120">

var dataset = [ 25, 7, 5, 26, 11 ];

d3.select("#demo0604").selectAll("div")
  .data(dataset)
  .enter()
  .append("div")
  .attr("class", "bar2")
  .style("height", function(d) {
    var barHeight = d * 5;
    return barHeight + "px";
  });
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0604() {
      var dataset = [ 25, 7, 5, 26, 11 ];
      
      d3.select("#demo0604").selectAll("div")
        .data(dataset)
        .enter()
        .append("div")
        .attr("class", "bar2")
        .style("height", function(d) {
          var barHeight = d * 5;
          return barHeight + "px";
        });
  }
</script>
<!-- ---------------------- -->

<div>
  <img src="https://www.svgrepo.com/show/3300/hammock.svg" width="128">
</div>

<p>
Let’s <span style="color:red">add many more</span>!
</p>




<!-- ---------------------- -->
<div>
  D3: Bar chart, extended with more values
  <div id="demo0605"></div>
  <hr>
  <button onclick="myFunction0605()">chapter_06/05_power_of_data_more_points.html</button>
  <hr>
  <textarea rows="14" cols="120">

var dataset = [ 25, 7, 5, 26, 11, 8, 25, 14, 23, 19, 14, 11, 22, 29, 11, 13, 12, 17, 18, 10, 24, 18, 25, 9, 3 ];

d3.select("#demo0605").selectAll("div")
  .data(dataset)
  .enter()
  .append("div")
  .attr("class", "bar2")
  .style("height", function(d) {
    var barHeight = d * 5;
    return barHeight + "px";
  });
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0605() {
      var dataset = [ 25, 7, 5, 26, 11, 8, 25, 14, 23, 19, 14, 11, 22, 29, 11, 13, 12, 17, 18, 10, 24, 18, 25, 9, 3 ];
      
      d3.select("#demo0605").selectAll("div")
        .data(dataset)
        .enter()
        .append("div")
        .attr("class", "bar2")
        .style("height", function(d) {
          var barHeight = d * 5 + 10;
          return barHeight + "px";
        });
  }
</script>
<!-- ---------------------- -->

<div>
  <img src="https://www.svgrepo.com/show/16299/bus.svg" width="128">
</div>

<p>
Give <span style="color:red">data()</span> 10 values, and it will loop through <span style="color:red">10 times</span>. 

<!-- Give it one million values, and it will loop through one million times. (Just be patient.) -->

</p>


<div>
  <img src="https://www.svgrepo.com/show/3300/hammock.svg" width="128">
</div>


<p>
That is the power of <span style="color:red">data()</span>.
</p>


<div>
  <img src="https://www.svgrepo.com/show/2473/cutlery.svg" width="128">
</div>

<p>
Remember, the <span style="color:red">data is driving the visualization</span>.
</p>



<h3>Random Data</h3>
<p>
Generate random data values.
</p>



<div>
  <img src="https://www.svgrepo.com/show/8325/calendar.svg" width="128">
</div>




<!-- ---------------------- -->
<div>
  D3: Bar chart with random values
  <div id="demo0606"></div>
  <hr>
  <button onclick="myFunction0606()">chapter_06/06_power_of_data_random.html (多按幾次) </button>
  <hr>
  <textarea rows="22" cols="120">

var dataset = [];              //Initialize empty array

for (var i = 0; i < 25; i++) {       //Loop 25 times
  var newNumber = Math.random() * 30;  //New random number (0-30)
  dataset.push(newNumber);       //Add new number to array
}

d3.select("#demo0606").html(''); // 清空

d3.select("#demo0606").selectAll("div")
  .data(dataset)
  .enter()
  .append("div")
  .attr("class", "bar2")
  .style("height", function(d) {
    var barHeight = d * 5;
    return barHeight + "px";
  });
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0606() {
      var dataset = [];              //Initialize empty array
      for (var i = 0; i < 25; i++) {       //Loop 25 times
        var newNumber = Math.random() * 30;  //New random number (0-30)
        dataset.push(newNumber);       //Add new number to array
      }

      d3.select("#demo0606").html(''); // 清空

      d3.select("#demo0606").selectAll("div")
        .data(dataset)
        .enter()
        .append("div")
        .attr("class", "bar2")
        .style("height", function(d) {
          var barHeight = d * 5;
          return barHeight + "px";
        });
  }
</script>
<!-- ---------------------- -->


<div>
  <img src="https://www.svgrepo.com/show/11568/lamp.svg" width="128">
  <img src="https://www.svgrepo.com/show/10666/backpack.svg" width="128">
  <img src="https://www.svgrepo.com/show/10993/shopping-bag.svg" width="128">
</div>



<p>
Wrap 包裹 the <span style="color:red">random number generator</span> from this line:
</p>


<div>
  <textarea rows="3" cols="100">
var newNumber = Math.random() * 30;
  </textarea>
</div>



<p>
as follows:
</p>
<div>
  <textarea rows="3" cols="100">
var newNumber = Math.floor(Math.random() * 30);
  </textarea>
</div>


<div>
  <img src="https://www.svgrepo.com/show/3299/gel.svg" width="128">
</div>


<p>
  Using this code, <span style="color:red">newNumber</span> would always be <span style="color:red">either 0 or 29</span>, or <span style="color:red">any integer in between</span>.
<!--
Why not 30? Because Math.random() always returns values less than 1.0, and Math.floor() will always round down, so 29 is the highest possible return value.
-->

<br><br>
  Try it out in <span style="color:red">07_power_of_data_rounded.html</span>, and use the console to verify that the numbers have indeed been rounded to integers.

<!--
<br><br>

That’s about all we can do visually with divs. Let’s expand our visual possibilities with SVG.
-->
</p>


<div>
  <img src="https://www.svgrepo.com/show/809/towel.svg" width="128">
</div>



<!-- ---------------------- -->
<div>
  D3: Bar chart with random (rounded) values
  <div id="demo0607"></div>
  <hr>
  <button onclick="myFunction0607()">chapter_06/07_power_of_data_rounded.html</button>
  <hr>
  <textarea rows="22" cols="120">

var dataset = [];              //Initialize empty array
for (var i = 0; i < 25; i++) {       //Loop 25 times
  var newNumber = Math.floor(Math.random() * 30);  //New random integer (0-29)
  dataset.push(newNumber);       //Add new number to array
}

d3.select("#demo0607").html('');

d3.select("#demo0607").selectAll("div")
  .data(dataset)
  .enter()
  .append("div")
  .attr("class", "bar2")
  .style("height", function(d) {
    var barHeight = d * 5;
    return barHeight + "px";
  });
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0607() {
      var dataset = [];              //Initialize empty array
      for (var i = 0; i < 25; i++) {       //Loop 25 times
        var newNumber = Math.floor(Math.random() * 30);  //New random integer (0-29)
        dataset.push(newNumber);       //Add new number to array
      }

      d3.select("#demo0607").html('');

      //d3.select("#demo0607").style("height", "200px").style("background-color", "red");
      //d3.select("#demo0607").style("height", "200px");

      d3.select("#demo0607").selectAll("div")
        .data(dataset)
        .enter()
        .append("div")
        .attr("class", "bar2")
        .style("height", function(d) {
          var barHeight = d * 5;
          return barHeight + "px";
        });
  }
</script>
<!-- ---------------------- -->



<h3>Drawing SVGs</h3>


<p>
One thing you might notice about SVG elements is that all of their properties are specified as <span style="color:red">attributes</span>. 

<br><br>

That is, they are included as <span style="color:red">property/value pairs</span> within each element tag, like this:
</p>
<div>
  <textarea rows="3" cols="100">
<element property="value"></element>
  </textarea>
</div>


<p>
We have already used D3’s handy <span style="color:red">append()</span> and <span style="color:red">attr()</span> methods to create new
HTML elements and set their attributes. 

<br><br>
Because SVG elements exist in the DOM, just as HTML elements do, we can use <span style="color:red">append()</span> and <span style="color:red">attr()</span> in exactly the same way to generate SVG images.
</p>


<div>
  <img src="https://www.svgrepo.com/show/255830/svg.svg" width="128">
</div>


<h3>Create the SVG</h3>
<p>
First, we need to create the <span style="color:red">SVG element</span> in which to place all our shapes:
</p>
<div>
  <textarea rows="3" cols="100">
d3.select("body").append("svg");
  </textarea>
</div>

<p>
That will find the document’s <span style="color:red">body</span> and append a new <span style="color:red">svg element</span> just before the
closing </ body> tag. 

<br><br>
That code will work, but I’d like to suggest a slight modification:
</p>
<div>
  <textarea rows="3" cols="100">
var svg = d3.select("body").append("svg");
  </textarea>
</div>

<div>
  <img src="https://www.svgrepo.com/show/19992/stairs.svg" width="128">
</div>



<p>
Remember how <span style="color:red">most D3 methods return a reference to the DOM element</span> on which they act? 

<br><br>
By creating a new variable svg, we are able to capture the reference handed back by <span style="color:red">append()</span>. 

<br><br>
Think of svg <span style="color:red">not as a variable</span> but as <span style="color:red">a reference pointing to the
SVG object</span> that we just created. 

<br><br>
This <span style="color:red">reference</span> will save us a lot of code later.

Instead of having to search for that SVG each time—as in <span style="color:red">d3.select("svg")</span>—we just say svg:
</p>

<div>
  <textarea rows="3" cols="100">
svg.attr("width", 500)
   .attr("height", 50);
  </textarea>
</div>


<p>
Alternatively, that could all be written as <span style="color:red">one line</span> of code:
</p>
<div>
  <textarea rows="6" cols="100">
var svg = d3.select("body")
            .append("svg")
            .attr("width", 500)
            .attr("height", 50);
  </textarea>
</div>


<p>
See <span style="color:red">08_drawing_svgs.html</span> for that code. 

<br><br>
You won’t see anything visually yet, but inspect the <span style="color:red">DOM</span> and verify that there is, indeed, an <span style="color:red">empty SVG element</span>.
</p>


<div>
  <img src="https://www.svgrepo.com/show/44422/cocktail.svg" width="128">
</div>




<!-- ---------------------- -->
<div>
  D3: Creating an empty SVG
  <div id="demo0608"></div>
  <hr>
  <button onclick="myFunction0608()">chapter_06/08_drawing_svgs.html</button>
  <hr>
  <textarea rows="6" cols="100">
//Create SVG element
var svg = d3.select("#demo0608")
      .append("svg")
      .attr("width", 500)
      .attr("height", 50);
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0608() {
      //Create SVG element
      var svg = d3.select("#demo0608")
            .append("svg")
            .attr("width", 500)
            .attr("height", 50);
  }
</script>
<!-- ---------------------- -->




<p>
To simplify your life, I recommend putting the <span style="color:red">width</span> and <span style="color:red">height</span> values into variables
at the top of your code, as in <span style="color:red">09_drawing_svgs_size.html</span>. 
<!--
View the source, and you’ll see the following code:
-->
</p>
<div>
  <textarea rows="4" cols="100">
//Width and height
var w = 500;
var h = 50;
  </textarea>
</div>




<div>
  <img src="https://www.svgrepo.com/show/50235/fast-food.svg" width="128">
</div>



<!-- ---------------------- -->
<div>
  D3: Putting the SVG's width and height into variables
  <div id="demo0609"></div>
  <hr>
  <button onclick="myFunction0609()">chapter_06/09_drawing_svgs_size.html</button>
  <hr>
  <textarea rows="12" cols="120">
//Width and height
var w = 500;
var h = 50;

//Create SVG element
var svg = d3.select("#demo0609")
      .append("svg")
      .attr("width", w)
      .attr("height", h);
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0609() {
      //Width and height
      var w = 500;
      var h = 50;
      
      //Create SVG element
      var svg = d3.select("#demo0609")
            .append("svg")
            .attr("width", w)
            .attr("height", h);
  }
</script>
<!-- ---------------------- -->


<p>
  <!--
  I’ll be doing that with all future examples. 
-->
  By variabalizing the size values, you can easily reference them throughout your code, as in the following:
</p>

<div>
  <textarea rows="6" cols="100">
var svg = d3.select("body")
            .append("svg")
            .attr("width", w) // <-- Here
            .attr("height", h); // <-- and here!
  </textarea>
</div>


<div>
  <img src="https://www.svgrepo.com/show/52256/open.svg" width="128">
</div>

<!--
<p>
Also, if you send me a petition to make “variabalize” a real word, I will gladly sign it.
</p>
-->




<h3>Data-Driven Shapes</h3>
<p>
Time to add some shapes. 

<!-- I’ll bring back our trusty old dataset:-->
</p>

<div>
  <textarea rows="3" cols="100">
var dataset = [ 5, 10, 15, 20, 25 ];
  </textarea>
</div>


<p>
and then use <span style="color:red">data()</span> to iterate through each data point, <span style="color:red">creating a circle</span> for each one:
</p>
<div>
  <textarea rows="6" cols="100">
svg.selectAll("circle")
    .data(dataset)
    .enter()
    .append("circle");
  </textarea>
</div>


<p>
Remember, 

<br><br>
<span style="color:red">selectAll()</span> will return <span style="color:red">empty references</span> to all circles (which don’t
exist yet), 

<br><br>
<span style="color:red">data()</span> binds our data to the elements we’re about to create, 

<br><br>
<span style="color:red">enter()</span> returns a <span style="color:red">placeholder reference to the new element</span>, and 

<br><br>
<span style="color:red">append()</span> finally adds a circle to the DOM.

<!-- In this case, it appends those circles to the end of the SVG element,
as our initial selection is our reference svg (as opposed to the document body, for example).-->

</p>

<p>
  To make it easy to reference all of the circles later, we can create a new <span style="color:red">variable</span> to
store references to them all:
</p>
<div>
  <textarea rows="6" cols="100">
var circles =  svg.selectAll("circle")
                  .data(dataset)
                  .enter()
                  .append("circle");
  </textarea>
</div>


<p>
Great, but all these circles still need positions and sizes, displayed in Figure 6-11. 

<!-- Be warned, the following code might blow your mind:-->
</p>

<div>
  <textarea rows="8" cols="100">
circles.attr("cx", function(d, i) {
                      return (i * 60) + 25;
                    })
        .attr("cy", h/2)
        .attr("r", function(d) {
                      return d;
                    });
  </textarea>
</div>




<div>
  <img src="https://www.svgrepo.com/show/40642/hairdryer.svg" width="128">
</div>



<!-- ---------------------- -->
<div>
  D3: Drawing SVG circles with data
  <div id="demo0610"></div>
  <hr>
  <button onclick="myFunction0610()">chapter_06/10_drawing_svgs_circles.html</button>
  <hr>
  <textarea rows="30" cols="100">

      //Width and height
      var w = 500;
      var h = 50;
      
      //Data
      var dataset = [ 5, 10, 15, 20, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0610")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      var circles = svg.selectAll("circle")
          .data(dataset)
          .enter()
          .append("circle");

      circles.attr("cx", function(d, i) {
            return (i * 60) + 25;
          })
           .attr("cy", h/2)
           .attr("r", function(d) {
            return d;
           });
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0610() {
      //Width and height
      var w = 500;
      var h = 50;
      
      //Data
      var dataset = [ 5, 10, 15, 20, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0610")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      var circles = svg.selectAll("circle")
          .data(dataset)
          .enter()
          .append("circle");

      circles.attr("cx", function(d, i) {
            return (i * 60) + 25;
          })
           .attr("cy", h/2)
           .attr("r", function(d) {
            return d;
           });
  }
</script>
<!-- ---------------------- -->


<p>
Feast your eyes on the demo <span style="color:red">10_drawing_svgs_circles.html</span>. Let’s step through the
code, one line at a time:
</p>
<div>
  <textarea rows="4" cols="100">
circles.attr("cx", function(d, i) {
    return (i * 50) + 25;
})
  </textarea>
</div>



<p>
This takes the reference to all circles and sets the <span style="color:red">cx</span> attribute for each one.
<!--
(Remember that, in SVG lingo, cx is the x-position value of the center of the circle.)
-->

<br><br>
Our data has already been bound to the circle elements, so for each circle, the
value <span style="color:red">d</span> matches the corresponding value in our original dataset (5, 10, 15, 20, or 25).
</p>



<div>
  <img src="https://www.svgrepo.com/show/51688/room-key.svg" width="128">
</div>


<p>Another value, <span style="color:red">i</span>, is also automatically populated for us. (Thanks, D3!) 

<!--
Just as with d, the name i here is arbitrary and could be set to whatever you like, such as counter or elementID. 

I prefer to use i because it is concise, it alludes to the convention of using
i in for loops, and it is very common, as you’ll see it in all the online examples.
-->
</p>



<div>
  <img src="https://www.svgrepo.com/show/43776/towels.svg" width="128">
</div>


<p>So, <span style="color:red">i</span> is a numeric index value of the <span style="color:red">current element</span>. 

<!--
Counting <span style="color:red">starts at zero</span>, so for our “first” circle i == 0, the second circle’s i == 1, and so on. 

We’re using i to push each subsequent circle over to the right, because each subsequent loop through, the value of i increases by one:
-->
</p>


<div>
  <textarea rows="6" cols="100">
(0 * 50) + 25 //Returns 25
(1 * 50) + 25 //Returns 75
(2 * 50) + 25 //Returns 125
(3 * 50) + 25 //Returns 175
(4 * 50) + 25 //Returns 225
  </textarea>
</div>


<p>
To make sure <span style="color:red">i</span> is available to your custom function, you must include it as an argument
in the function definition, function(d, <span style="color:red">i</span>). 
<!--
You must also include d, even if you don’t use d within your function (as in the preceding case). This is because the
index value is always passed into the second argument; you can’t get the index without also getting the data value, even if you have no use for the latter.
-->
</p>


<p>On to the next line:</p>

<div>
  <textarea rows="3" cols="100">
.attr("cy", h/2)
  </textarea>
</div>



<div>
  <img src="https://www.svgrepo.com/show/43794/rent-a-car.svg" width="128">
</div>


<p>
<span style="color:red">cy</span> is the y-position value of the center of each circle. 
<br><br>
  We’re setting cy to <span style="color:red">h divided by two</span>, or one-half of h. 
<br><br>
  You’ll recall that <span style="color:red">h</span> stores the height of the entire SVG, so <span style="color:red">h/2</span> has the effect of <span style="color:red">aligning all circles in the vertical center</span> of the SVG image:
</p>
<div>
  <textarea rows="4" cols="100">
.attr("r", function(d) {
  return d;
});
  </textarea>
</div>


<p>
  Finally, the radius <span style="color:red">r</span> of each circle is simply set to <span style="color:red">d</span>, the corresponding data value.
<!--
(Note: Never use radius to express data values, for reasons I’ll address later in this chapter.)
-->
</p>





<h3>Pretty Colors, Oooh!</h3>

<p>
Color fills and strokes are just other attributes that you can set using the same methods.
<!--
Simply by appending this code:
-->
</p>
<div>
  <textarea rows="6" cols="100">
.attr("fill", "yellow")
.attr("stroke", "orange")
.attr("stroke-width", function(d) {
      return d/2;
});
  </textarea>
</div>




<div>
  <img src="https://www.svgrepo.com/show/53076/safebox.svg" width="128">
</div>




<!-- ---------------------- -->
<div>
  D3: Using color in SVG
  <div id="demo0611"></div>
  <hr>
  <button onclick="myFunction0611()">chapter_06/11_drawing_svgs_color.html</button>
  <hr>
  <textarea rows="32" cols="100">

      //Width and height
      var w = 500;
      var h = 100;
      
      //Data
      var dataset = [ 5, 10, 15, 20, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0611")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      var circles = svg.selectAll("circle")
          .data(dataset)
          .enter()
          .append("circle");

      circles.attr("cx", function(d, i) {
            return (i * 50) + 25;
          })
           .attr("cy", h/2)
           .attr("r", function(d) {
            return d;
           })
           .attr("fill", "yellow")
           .attr("stroke", "orange")
           .attr("stroke-width", function(d) {
            return d/2;
           });
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0611() {
      //Width and height
      var w = 500;
      var h = 100;
      
      //Data
      var dataset = [ 5, 10, 15, 20, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0611")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      var circles = svg.selectAll("circle")
          .data(dataset)
          .enter()
          .append("circle");

      circles.attr("cx", function(d, i) {
            return (i * 60) + 25;
          })
           .attr("cy", h/2)
           .attr("r", function(d) {
            return d;
           })
           .attr("fill", "yellow")
           .attr("stroke", "orange")
           .attr("stroke-width", function(d) {
            return d/2;
           });
  }
</script>
<!-- ---------------------- -->



<div>
  <img src="https://www.svgrepo.com/show/46309/shower.svg" width="128">
</div>

<!--

<p>
  Note that the top and bottom edges of the far-right circle are cut off where they
exceed the boundaries of the SVG image. Inspect the DOM to see how the circle is
actually “taller” than the SVG.
</p>


<p>
  Of course, you can mix and match attributes and custom functions to apply any combination
of properties. The trick with data visualization, of course, is choosing appro‐priate mappings, so the visual expression of your data is understandable and useful
for the viewer.
</p>



<div>
  <img src="" width="128">
</div>

-->

<h3>Making a Bar Chart</h3>


<p>
  Now we’ll integrate everything we’ve learned so far to generate a simple <span style="color:red">bar chart</span> as an <span style="color:red">SVG image</span>.
<!--
<br><br>
We’ll start by adapting the div bar chart code to draw its bars with SVG instead, giving
us more flexibility over the visual presentation. Then we’ll add labels, so we can
see the data values clearly.
-->
</p>


<h3>The Old Chart</h3>

<p>
  See the <span style="color:red">div</span> chart, updated with some new data, in <span style="color:red">12_making_a_bar_chart_divs.html</span>:
</p>





<!-- ---------------------- -->
<div>
  D3: A bar chart with divs
  <div id="demo0612"></div>
  <hr>
  <button onclick="myFunction0612()">chapter_06/12_making_a_bar_chart_divs.html</button>
  <hr>
  <textarea rows="16" cols="120">
var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
        11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];

d3.select("#demo0612").selectAll("div")
  .data(dataset)
  .enter()
  .append("div")
  .attr("class", "bar2")
  .style("height", function(d) {
      var barHeight = d * 5;
      return barHeight + "px";
  });
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0612() {
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      d3.select("#demo0612").selectAll("div")
        .data(dataset)
        .enter()
        .append("div")
        .attr("class", "bar2")
        .style("height", function(d) {
          var barHeight = d * 5;
          return barHeight + "px";
        });
  }
</script>
<!-- ---------------------- -->



<div>
  <img src="https://www.svgrepo.com/show/46310/location.svg" width="128">
</div>


<h3>The New Chart</h3>

<p>
  First, we need to decide on the <span style="color:red">size</span> of the new SVG:
</p>
<div>
  <textarea rows="4" cols="100">
//Width and height
var w = 500;
var h = 100;
  </textarea>
</div>

<!--
<p>

  Of course, you could name w and h something else, like svgWidth and svgHeight. 

  Use whatever is most clear to you. JavaScript programmers, as a group, are fixated on efficiency,
so you’ll often see single-character variable names, code written with no
spaces, and other hard-to-read, yet programmatically efficient, syntax.
</p>



<div>
  <img src="" width="128">
</div>
-->


<p>
  Then, we tell D3 to create an <span style="color:red">empty SVG element</span> and add it to the <span style="color:red">DOM</span>:
</p>
<div>
  <textarea rows="6" cols="100">
//Create SVG element
var svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h);
  </textarea>
</div>


<p>
  To recap, this inserts a new <span style="color:red">< svg ></span> element just before the closing </ body> tag, and
assigns the SVG a <span style="color:red">width</span> and <span style="color:red">height</span> of 500 by 100 pixels. 

<!--
This statement also puts the result into our new variable called svg, so we can easily reference the new SVG
without having to reselect it later using something like d3.select("svg").
-->
</p>

<p>
  Next, instead of creating divs, we generate <span style="color:red">rects</span> and add them to svg:
</p>

<div>
  <textarea rows="10" cols="100">
svg.selectAll("rect")
    .data(dataset)
    .enter()
    .append("rect")
    .attr("x", 0)
    .attr("y", 0)
    .attr("width", 20)
    .attr("height", 100);
  </textarea>
</div>


<p>
  This code selects all <span style="color:red">rects</span> inside of svg. 
<br><br>
  Of course, there aren’t any yet, so an empty selection is returned. 

<br><br>
  (<span style="color:red">Weird</span>, yes, but stay with me. With D3, you always have to first
<span style="color:red">select whatever it is you’re about to act on</span>, even if that selection is momentarily empty.)


<br><br>
  Then, <span style="color:red">data(dataset)</span> sees that we have 20 values in the dataset, and those values are
handed off to <span style="color:red">enter()</span> for processing. 

<br><br>
<span style="color:red">enter()</span>, in turn, returns a <span style="color:red">placeholder</span> selection
for each data point that does not yet have a corresponding <span style="color:red">rect</span>—which is to say, all of them.

<br><br>
  For each of the 20 placeholders, <span style="color:red">append("rect")</span> inserts a rect into the DOM. 

<br><br>
  As we learned in Chapter 3, every rect must have x, y, width, and height values. 

<br><br>
We use <span style="color:red">attr()</span> to add those attributes onto each newly created rect.
</p>


<p>
  <!--
  Beautiful, no? Okay, maybe not. 
-->

  All of the bars are there (check the DOM of <span style="color:red">13_making_
a_bar_chart_rects.html</span> with your web inspector), but they all share the same x, y,
width, and height values, with the result that <span style="color:red">they all overlap</span> 擠在一起 (see Figure 6-14). 

<!--
This isn’t a visualization of data yet.
-->
</p>


<div>
  <img src="https://www.svgrepo.com/show/99042/golf.svg" width="128">
</div>




<!-- ---------------------- -->
<div>
  D3: Making a bar chart with SVG rects
  <div id="demo0613"></div>
  <hr>
  <button onclick="myFunction0613()">chapter_06/13_making_a_bar_chart_rects.html</button>
  <hr>
  <textarea rows="24" cols="100">

      //Width and height
      var w = 500;
      var h = 100;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0613")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", 0)
         .attr("y", 0)
         .attr("width", 20)
         .attr("height", 100);
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0613() {
      //Width and height
      var w = 500;
      var h = 100;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0613")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", 0)
         .attr("y", 0)
         .attr("width", 20)
         .attr("height", 100);
  }
</script>
<!-- ---------------------- -->


<div>
  <img src="" width="128">
</div>




<p>
<!--
  Let’s fix the overlap issue first. 
-->

  Instead of an <span style="color:red">x</span> of 0, we’ll assign a dynamic value that <span style="color:red">corresponds to i</span>, or each value’s position in the dataset. 

<br><br>

  So the <span style="color:red">first bar</span> will be at <span style="color:red">0</span>, but subsequent bars will be at <span style="color:red">21</span>, then <span style="color:red">42</span>, and so on. 

<!--
  (In a later chapter, we’ll learn about D3’s scales, which offer a better, more flexible way to accomplish this same feat.)
-->
</p>
<div>
  <textarea rows="4" cols="100">
.attr("x", function(d, i) {
  return i * 21; //Bar width of 20 plus 1 for padding
})
  </textarea>
</div>



<p>
  See that code in action with <span style="color:red">14_making_a_bar_chart_offset.html</span>
</p>



<div>
  <img src="https://www.svgrepo.com/show/323966/car.svg" width="128">
</div>


<!-- ---------------------- -->
<div>
  D3: Making a bar chart with SVG rects, spacing
  <div id="demo0614"></div>
  <hr>
  <button onclick="myFunction0614()">chapter_06/14_making_a_bar_chart_offset.html</button>
  <hr>
  <textarea rows="28" cols="100">

      //Width and height
      var w = 500;
      var h = 100;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0614")
                  .append("svg")
                  .attr("width", w)
                  .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * 21;  //Bar width of 20 plus 1 for padding
         })
         .attr("y", 0)
         .attr("width", 20)
         .attr("height", 100);
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0614() {
      //Width and height
      var w = 500;
      var h = 100;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0614")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * 21;  //Bar width of 20 plus 1 for padding
         })
         .attr("y", 0)
         .attr("width", 20)
         .attr("height", 100);
  }
</script>
<!-- ---------------------- -->



<div>
  <img src="" width="128">
</div>



<p>

  That works, but it’s not particularly <span style="color:red">flexible</span>. 
<br><br>
  If our dataset were longer, then the bars would just run off to the right, <span style="color:red">past the end of the SVG</span>! 
<!--
  Because each bar is 20 pixels wide, plus 1 pixel of padding, a 500-pixel wide SVG can only accommodate 23 data points.
-->
</p>







<!-- ---------------------- -->
<div>
  D3: Making a bar chart with SVG rects, evenly spaced
  <div id="demo0615"></div>
  <hr>
  <button onclick="myFunction0615()">chapter_06/15_making_a_bar_chart_even.html</button>
  <hr>
  <textarea rows="28" cols="100">

      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0615")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", 0)
         .attr("width", 20)
         .attr("height", 100);
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0615() {
      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0615")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", 0)
         .attr("width", 20)
         .attr("height", 100);
  }
</script>
<!-- ---------------------- -->



<p>

It’s good practice to use flexible, dynamic coordinates—heights, widths, x values, and
y values—so your visualization can scale appropriately along with your data.

<br><br>
<!--
  As with anything else in programming, there are a thousand ways to achieve that end.
I’ll use a simple one. 
-->

First, I’ll amend the line where we set each bar’s <span style="color:red">x-position</span>:

</p>


<div>
  <textarea rows="4" cols="100">
.attr("x", function(d, i) {
  return i * (w / dataset.length);
})
  </textarea>
</div>

<p>
Notice how the x value is now tied directly to the <span style="color:red">width of the SVG</span> (w) and the number of values in the dataset (<span style="color:red">dataset.length</span>). 

<br><br>
  This is exciting because now our bars will be <span style="color:red">evenly spaced</span>, whether we have <span style="color:red">20 data valuesas</span> in Figure 6-17… , …or only <span style="color:red">five</span>, as in Figure 6-18.
</p>

<div>
  <div id="demo0615-1"></div>
  Figure 6-17. Twenty evenly spaced bars
  <hr>
  <div id="demo0615-2"></div>
  Figure 6-18. Five evenly spaced bars
</div>

<script type="text/javascript">

      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;


      // Figure 6-17. Twenty evenly spaced bars
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0615-1")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", 0)
         .attr("width", 20)
         .attr("height", 100);
      
      // Figure 6-18. Five evenly spaced bars
      var dataset = [ 5, 10, 13, 19, 21 ];
      
      //Create SVG element
      var svg = d3.select("#demo0615-2")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", 0)
         .attr("width", 20)
         .attr("height", 100);

</script>



<p>See that code so far in <span style="color:red">15_making_a_bar_chart_even.html</span>.</p>




<div>
  <img src="https://www.svgrepo.com/show/323973/car-battery.svg" width="128">
</div>


<h3>16_making_a_bar_chart_widths.html</h3>

<p>

Now we should set the <span style="color:red">bar widths</span> to be <span style="color:red">proportional</span>, too, so they get 
<br>
<span style="color:red">narrower</span> as more data is added, or 
<br>
<span style="color:red">wider</span> when there are fewer values. 

<!--
I’ll add a new variable near where we set the SVG’s width and height:
<br>
and then reference that variable in the line where we set each bar’s width. 
-->
</p>

<div>
  <textarea rows="6" cols="100">
//Width and height
var w = 500;
var h = 100;
var barPadding = 1; // <-- New!
  </textarea>
</div>

<p>
Instead of a static value of 20, the <span style="color:red">width</span> will now be set as <span style="color:red">a fraction of the SVG width and number of data points</span>, minus a <span style="color:red">padding</span> value:
</p>


<div>
  <textarea rows="3" cols="100">
.attr("width", w / dataset.length - barPadding)
  </textarea>
</div>

<p>
  It works! 
<br><br>
  (See Figure 6-19 and <span style="color:red">16_making_a_bar_chart_widths.html</span>.)
</p>

<p>
The <span style="color:red">bar widths</span> and <span style="color:red">x-positions</span> scale correctly whether there are 
<br>
<span style="color:red">20</span> points, 
<br>
only <span style="color:red">5</span> (see Figure 6-20), 
<br>
or even <span style="color:red">100</span> (see Figure 6-21).
</p>

<div>
  <div id="demo0616-1"></div>
  Figure 6-19. <span style="color:red">Twenty</span> evenly spaced bars with dynamic widths
  <hr>
  <div id="demo0616-2"></div>
  Figure 6-20. <span style="color:red">Five</span> evenly spaced bars with dynamic widths
  <hr>
  <div id="demo0616-3"></div>
  Figure 6-21. <span style="color:red">One hundred</span> evenly spaced bars with dynamic widths
</div>


<div>
  <img src="https://www.svgrepo.com/show/324057/student.svg" width="128">
</div>




<script type="text/javascript">

      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      // Figure 6-19. Twenty evenly spaced bars with dynamic widths
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0616-1")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", 0)
         .attr("width", w / dataset.length - barPadding)
         .attr("height", 100);

      // Five evenly spaced bars with dynamic widths
      var dataset = [ 5, 10, 13, 19, 21 ];
      
      //Create SVG element
      var svg = d3.select("#demo0616-2")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", 0)
         .attr("width", w / dataset.length - barPadding)
         .attr("height", 100);

      // Figure 6-19. Twenty evenly spaced bars with dynamic widths
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25,
              5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25,
              5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25,
              5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25,
              5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0616-3")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", 0)
         .attr("width", w / dataset.length - barPadding)
         .attr("height", 100);
</script>





<!-- ---------------------- -->
<div>
  D3: Making a bar chart with SVG rects, <span style="color:red">dynamic widths</span> and <span style="color:red">spacing</span>
  <div id="demo0616"></div>
  <hr>
  <button onclick="myFunction0616()">chapter_06/16_making_a_bar_chart_widths.html</button>
  <hr>
  <textarea rows="28" cols="100">

      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0616")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", 0)
         .attr("width", w / dataset.length - barPadding)
         .attr("height", 100);
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0616() {
      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0616")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", 0)
         .attr("width", w / dataset.length - barPadding)
         .attr("height", 100);
  }
</script>
<!-- ---------------------- -->


<div>
  <img src="" width="128">
</div>


<h3>17_making_a_bar_chart_heights.html</h3>


<p>
  Finally, we encode our <span style="color:red">data</span> as the <span style="color:red">height</span> of each bar. 
<!--
  You would hope it were as easy
as referencing the d data value when setting each bar’s height:
-->
</p>

<div>
  <textarea rows="4" cols="100">
.attr("height", function(d) {
  return d;
});
  </textarea>
</div>

<p>Hmm, the chart in <span style="color:red">Figure 6-22</span> looks funky.</p>



<div>
  <div id="demo0616-4"></div>
  Figure 6-22. Dynamic heights
</div>

<script type="text/javascript">

      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      // Figure 6-19. Twenty evenly spaced bars with dynamic widths
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0616-4")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", 0)
         .attr("width", w / dataset.length - barPadding)
         .attr("height", function(d) {
            return d;
         });
</script>



<p>Maybe we can just <span style="color:red">scale up</span> our numbers a bit?</p>



<div>
  <textarea rows="4" cols="100">
.attr("height", function(d) {
return d * 4; // <-- Times four!
});
  </textarea>
</div>

<p>
<!--
  Alas, it is not that easy! 
-->
  We want our bars to <span style="color:red">grow upward</span> from the bottom edge, not
down from the top, as in <span style="color:red">Figure 6-23</span>—but don’t blame D3, blame SVG.</p>



<div>
  <img src="" width="128">
</div>


<div>
  <div id="demo0616-5"></div>
  Figure 6-23. Dynamic heights, magnified
</div>

<script type="text/javascript">

      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      // Figure 6-19. Twenty evenly spaced bars with dynamic widths
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0616-5")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", 0)
         .attr("width", w / dataset.length - barPadding)
         .attr("height", function(d) {
            return d * 4; // <-- Times four!
         });
</script>



<p>
You’ll recall that, when drawing SVG rects, the <span style="color:red">x</span> and <span style="color:red">y</span> values specify the coordinates of the <span style="color:red">upper-left corner</span>. 

<!--
That is, the origin or reference point for every rect is its top
left. For our purposes, it would be soooooo much easier to set the origin point as the
bottom-left corner, but that’s just not how SVG does it, and frankly, SVG is indifferent
about our feelings on the matter.
-->
</p>


<div>
  <img src="https://www.svgrepo.com/show/324061/thermometer-hot.svg" width="128">
</div>

<p>
<!--
Given that our bars do have to “grow down from the top,” then where is “the top” of
each bar in relationship to the top of the SVG? 
-->
Well, the <span style="color:red">top of each bar</span> could be expressed as a relationship between the <span style="color:red">height of the SVG</span> and the corresponding data value, as in:
</p>


<div>
  <textarea rows="4" cols="100">
.attr("y", function(d) {
    return h - d; //Height minus data value
})
  </textarea>
</div>

<p>
Then, to put the “<span style="color:red">bottom</span>” of the bar on the <span style="color:red">bottom of the SVG</span> (see Figure 6-24), each rect’s height can be just the data value itself:
</p>


<div>
  <textarea rows="4" cols="100">
.attr("height", function(d) {
    return d; //Just the data value
});
  </textarea>
</div>





<div>
  <div id="demo0617-1"></div>
  Figure 6-24. Growing down from above
</div>

<script type="text/javascript">
      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0617-1")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", function(d) {
            return h - (d);
         })
         .attr("width", w / dataset.length - barPadding)
         .attr("height", function(d) {
            return d;
         });
</script>



<p>Let’s <span style="color:red">scale things up</span> a bit by changing <span style="color:red">d</span> to <span style="color:red">d * 4</span>, with the result shown in Figure 6-25. 

<!--
(Just as with the bar placements, we could do this more properly using D3 scales, but we’re not there yet.)
-->
</p>


<div>
  <div id="demo0617-2"></div>
  Figure 6-25. Growing bigger from above
</div>

<script type="text/javascript">
      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0617-2")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", function(d) {
            return h - (d * 4);
         })
         .attr("width", w / dataset.length - barPadding)
         .attr("height", function(d) {
            return d * 4;
         });
</script>


<p>The working code for our <span style="color:red">growing-down-from-above</span>, SVG bar chart is in <span style="color:red">17_making_a_bar_chart_heights.html</span>.</p>




<div>
  <img src="https://www.svgrepo.com/show/324063/thundermill.svg" width="128">
</div>



<!-- ---------------------- -->
<div>
  D3: A true <span style="color:red">bar chart</span> with SVG <span style="color:red">rects</span>
  <div id="demo0617"></div>
  <hr>
  <button onclick="myFunction0617()">chapter_06/17_making_a_bar_chart_heights.html</button>
  <hr>
  <textarea rows="32" cols="100">

      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0617")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", function(d) {
            return h - (d * 4);
         })
         .attr("width", w / dataset.length - barPadding)
         .attr("height", function(d) {
            return d * 4;
         });
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0617() {
      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0617")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", function(d) {
            return h - (d * 4);
         })
         .attr("width", w / dataset.length - barPadding)
         .attr("height", function(d) {
            return d * 4;
         });
  }
</script>
<!-- ---------------------- -->



<div>
  <img src="https://www.svgrepo.com/show/324077/arrow-ecology.svg" width="128">
</div>



<h3>Color</h3>

<p>
  Adding color is easy. Just use <span style="color:red">attr()</span> to set a fill:
</p>

<div>
  <textarea rows="3" cols="100">
.attr("fill", "teal");
  </textarea>
</div>

<p>Find the all-teal bar chart shown in <span style="color:red">Figure 6-26</span> in <span style="color:red">18_making_a_bar_chart_teal.html</span>.</p>


<!-- ---------------------- -->
<div>
  D3: Adding color to an SVG bar chart
  <div id="demo0618"></div>
  <hr>
  <button onclick="myFunction0618()">chapter_06/18_making_a_bar_chart_teal.html</button>
  <hr>
  <textarea rows="32" cols="100">

      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0618")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", function(d) {
            return h - (d * 4);
         })
         .attr("width", w / dataset.length - barPadding)
         .attr("height", function(d) {
            return d * 4;
         })
         .attr("fill", "teal");
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0618() {
      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0618")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", function(d) {
            return h - (d * 4);
         })
         .attr("width", w / dataset.length - barPadding)
         .attr("height", function(d) {
            return d * 4;
         })
         .attr("fill", "teal");
  }
</script>
<!-- ---------------------- -->




<div>
  <img src="https://www.svgrepo.com/show/324067/usb.svg" width="128">
</div>


<p>
<!--
  Teal is nice, but you’ll often want a shape’s color to reflect some quality of the data.
-->

That is, you might want to <span style="color:red">encode the data values as color</span>. 
<!--
(In the case of our bar chart, that makes a dual encoding, in which the same data value is encoded in two different visual properties: both height and color.)
-->
<br><br>

Using data to drive color is as easy as writing a custom function that again references
<span style="color:red">d</span>. 
<br><br>
Here, we replace "teal" with a custom function, resulting in the chart in
Figure 6-27.
</p>

<div>
  <textarea rows="4" cols="100">
.attr("fill", function(d) {
  return "rgb(0, 0, " + Math.round(d * 10) + ")";
});
  </textarea>
</div>




<!-- ---------------------- -->
<div>
  D3: Adding dynamic color, based on data
  <div id="demo0619"></div>
  <hr>
  <button onclick="myFunction0619()">chapter_06/19_making_a_bar_chart_blues.html</button>
  <hr>
  <textarea rows="36" cols="100">

//Width and height
var w = 500;
var h = 100;
var barPadding = 1;

var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
        11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];

//Create SVG element
var svg = d3.select("#demo0619")
      .append("svg")
      .attr("width", w)
      .attr("height", h);

svg.selectAll("rect")
   .data(dataset)
   .enter()
   .append("rect")
   .attr("x", function(d, i) {
      return i * (w / dataset.length);
   })
   .attr("y", function(d) {
      return h - (d * 4);
   })
   .attr("width", w / dataset.length - barPadding)
   .attr("height", function(d) {
      return d * 4;
   })
   .attr("fill", function(d) {
    return "rgb(0, 0, " + Math.round(d * 10) + ")";
   });
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0619() {
      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0619")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", function(d) {
            return h - (d * 4);
         })
         .attr("width", w / dataset.length - barPadding)
         .attr("height", function(d) {
            return d * 4;
         })
         .attr("fill", function(d) {
          return "rgb(0, 0, " + Math.round(d * 10) + ")";
         });
  }
</script>
<!-- ---------------------- -->


<div>
  <img src="" width="128">
</div>



<p>
  See the code in <span style="color:red">19_making_a_bar_chart_blues.html</span>. 
<!--
  This is not a particularly useful visual encoding, but you can get the idea of how to translate data into color. 

  Here, d is multiplied by 10, and then rounded to the nearest whole number with Math.round().


The resulting number is used as the blue value in an rgb() color definition. 
-->
<br><br>
So the <span style="color:red">greater values of d</span> (taller bars) will be <span style="color:red">more blue</span>. 

<span style="color:red">Smaller values of d</span> (shorter bars) will be <span style="color:red">less blue</span> (closer to black). 

The red and green components of the color are
fixed at zero.
</p>


<h3>Labels</h3>

<!--
<p>
  Visuals are great, but sometimes you need to show the actual data values as text
within the visualization. Here’s where value labels come in, and they are very easy to
generate with D3.
</p>
-->

<p>
You’ll recall from the SVG primer that you can add text elements to an SVG element.
Let’s start with:
</p>

<div>
  <textarea rows="6" cols="100">
svg.selectAll("text")
    .data(dataset)
    .enter()
    .append("text")
  </textarea>
</div>


<p>
<!--
Look familiar? Just as we did for the rects, here we do for the texts. 

First, select what you want, bring in the data, enter the new elements (which are just placeholders at this point), and finally append the new text elements to the DOM.
-->

We’ll extend that code to include a data value within each <span style="color:red">text element</span> by using the <span style="color:red">text()</span> method:

</p>

<div>
  <textarea rows="4" cols="100">
.text(function(d) {
  return d;
})
  </textarea>
</div>




<div>
  <img src="https://www.svgrepo.com/show/324066/upload.svg" width="128">
</div>

<p>
  and then extend it further, by including <span style="color:red">x</span> and <span style="color:red">y</span> values to position the text. 
<!--
  It’s easiest if I just copy and paste the same x/y code we previously used for the bars:
-->
</p>

<div>
  <textarea rows="8" cols="100">
.attr("x", function(d, i) {
  return i * (w / dataset.length);
})
.attr("y", function(d) {
  return h - (d * 4);
});
  </textarea>
</div>

<p>
  Aha! Value labels! 
<br><br>
  But some are getting <span style="color:red">cut off</span> at the top (see Figure 6-28).
</p>


<div>
  <div id="demo0620-1"></div>
  Figure 6-28. Baby value labels!
</div>


<script type="text/javascript">

      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0620-1")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", function(d) {
            return h - (d * 4);
         })
         .attr("width", w / dataset.length - barPadding)
         .attr("height", function(d) {
            return d * 4;
         })
         .attr("fill", function(d) {
          return "rgb(0, 0, " + Math.round(d * 10) + ")";
         });

      svg.selectAll("text")
         .data(dataset)
         .enter()
         .append("text")
         .text(function(d) {
            return d;
         })
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", function(d) {
            return h - (d * 4);
         });

</script>



<div>
  <img src="https://www.svgrepo.com/show/324069/water.svg" width="128">
</div>




<p>
  Let’s try <span style="color:red">moving them down</span>, inside the bars, by adding a small amount to the x and y calculations:
</p>

<div>
  <textarea rows="8" cols="100">
.attr("x", function(d, i) {
  return i * (w / dataset.length) + 5; // +5
})
.attr("y", function(d) {
  return h - (d * 4) + 15; // +15
});
  </textarea>
</div>


<p>
  The chart in <span style="color:red">Figure 6-29</span> is better, but not legible (容易閱讀).
</p>


<div>
  <div id="demo0620-2"></div>
  Figure 6-29. In-bar value labels
</div>


<script type="text/javascript">

      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0620-2")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", function(d) {
            return h - (d * 4);
         })
         .attr("width", w / dataset.length - barPadding)
         .attr("height", function(d) {
            return d * 4;
         })
         .attr("fill", function(d) {
          return "rgb(0, 0, " + Math.round(d * 10) + ")";
         });

      svg.selectAll("text")
         .data(dataset)
         .enter()
         .append("text")
         .text(function(d) {
            return d;
         })
         .attr("x", function(d, i) {
            return i * (w / dataset.length) + 5;
         })
         .attr("y", function(d) {
            return h - (d * 4) + 15;
         });

</script>


<p>
  Fortunately, we can fix that:
</p>

<div>
  <textarea rows="4" cols="100">
.attr("font-family", "sans-serif")
.attr("font-size", "11px")
.attr("fill", "white");
  </textarea>
</div>


<p>
  Fantasti-code! 
  <br><br>
  See <span style="color:red">20_making_a_bar_chart_labels.html</span> for the brilliant visualization shown in Figure 6-30.
</p>



<div>
  <img src="https://www.svgrepo.com/show/324070/water-drops.svg" width="128">
</div>


<!-- ---------------------- -->
<div>
  D3: SVG bar chart with value labels
  <div id="demo0620"></div>
  Figure 6-30. Really nice value labels
  <hr>
  <button onclick="myFunction0620()">chapter_06/20_making_a_bar_chart_labels.html</button>
  <hr>
  <textarea rows="52" cols="100">

//Width and height
var w = 500;
var h = 100;
var barPadding = 1;

var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
        11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];

//Create SVG element
var svg = d3.select("#demo0620")
      .append("svg")
      .attr("width", w)
      .attr("height", h);

svg.selectAll("rect")
   .data(dataset)
   .enter()
   .append("rect")
   .attr("x", function(d, i) {
      return i * (w / dataset.length);
   })
   .attr("y", function(d) {
      return h - (d * 4);
   })
   .attr("width", w / dataset.length - barPadding)
   .attr("height", function(d) {
      return d * 4;
   })
   .attr("fill", function(d) {
    return "rgb(0, 0, " + Math.round(d * 10) + ")";
   });

svg.selectAll("text")
   .data(dataset)
   .enter()
   .append("text")
   .text(function(d) {
      return d;
   })
   .attr("x", function(d, i) {
      return i * (w / dataset.length) + 5;
   })
   .attr("y", function(d) {
      return h - (d * 4) + 15;
   })
   .attr("font-family", "sans-serif")
   .attr("font-size", "11px")
   .attr("fill", "white");
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0620() {
      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0620")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", function(d) {
            return h - (d * 4);
         })
         .attr("width", w / dataset.length - barPadding)
         .attr("height", function(d) {
            return d * 4;
         })
         .attr("fill", function(d) {
          return "rgb(0, 0, " + Math.round(d * 10) + ")";
         });

      svg.selectAll("text")
         .data(dataset)
         .enter()
         .append("text")
         .text(function(d) {
            return d;
         })
         .attr("x", function(d, i) {
            return i * (w / dataset.length) + 5;
         })
         .attr("y", function(d) {
            return h - (d * 4) + 15;
         })
         .attr("font-family", "sans-serif")
         .attr("font-size", "11px")
         .attr("fill", "white");
  }
</script>
<!-- ---------------------- -->



<div>
  <img src="" width="128">
</div>


<p>
  If you are not typographically obsessive (執著), then you’re all done. 

<!--
  If, however, you are like me, you’ll notice that the value labels aren’t perfectly aligned within their bars. 

  (For example, note the “5” in the first column.) That’s easy enough to fix. 
-->

  Let’s use the SVG <span style="color:red">text-anchor</span> attribute to center the text horizontally at the assigned <span style="color:red">x</span> value:
</p>


<div>
  <textarea rows="3" cols="100">
.attr("text-anchor", "middle")
  </textarea>
</div>


<p>
  Then, let’s change the way we calculate the x-position by setting it to the left edge of
each bar plus <span style="color:red">half the bar width</span>:
</p>

<div>
  <textarea rows="4" cols="100">
.attr("x", function(d, i) {
  return i * (w / dataset.length) + (w / dataset.length - barPadding) / 2;
})
  </textarea>
</div>



<div>
  <img src="https://www.svgrepo.com/show/324078/battery.svg" width="128">
</div>

<p>
  And I’ll also bring the labels up one pixel for perfect spacing, as you can see in
Figure 6-31 and <span style="color:red">21_making_a_bar_chart_aligned.html</span>:
</p>

<div>
  <textarea rows="4" cols="100">
.attr("y", function(d) {
  return h - (d * 4) + 14; //15 is now 14
})
  </textarea>
</div>


<!-- ---------------------- -->
<div>
  D3: SVG bar chart with value labels (centered)
  <div id="demo0621"></div>
  Figure 6-31. Centered labels
  <hr>
  <button onclick="myFunction0621()">chapter_06/21_making_a_bar_chart_aligned.html</button>
  <hr>
  <textarea rows="52" cols="100">

//Width and height
var w = 500;
var h = 100;
var barPadding = 1;

var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
        11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];

//Create SVG element
var svg = d3.select("#demo0621")
      .append("svg")
      .attr("width", w)
      .attr("height", h);

svg.selectAll("rect")
   .data(dataset)
   .enter()
   .append("rect")
   .attr("x", function(d, i) {
      return i * (w / dataset.length);
   })
   .attr("y", function(d) {
      return h - (d * 4);
   })
   .attr("width", w / dataset.length - barPadding)
   .attr("height", function(d) {
      return d * 4;
   })
   .attr("fill", function(d) {
    return "rgb(0, 0, " + Math.round(d * 10) + ")";
   });

svg.selectAll("text")
   .data(dataset)
   .enter()
   .append("text")
   .text(function(d) {
      return d;
   })
   .attr("text-anchor", "middle")
   .attr("x", function(d, i) {
      return i * (w / dataset.length) + (w / dataset.length - barPadding) / 2;
   })
   .attr("y", function(d) {
      return h - (d * 4) + 14;
   })
   .attr("font-family", "sans-serif")
   .attr("font-size", "11px")
   .attr("fill", "white");
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0621() {
      //Width and height
      var w = 500;
      var h = 100;
      var barPadding = 1;
      
      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
              11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      
      //Create SVG element
      var svg = d3.select("#demo0621")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
            return i * (w / dataset.length);
         })
         .attr("y", function(d) {
            return h - (d * 4);
         })
         .attr("width", w / dataset.length - barPadding)
         .attr("height", function(d) {
            return d * 4;
         })
         .attr("fill", function(d) {
          return "rgb(0, 0, " + Math.round(d * 10) + ")";
         });

      svg.selectAll("text")
         .data(dataset)
         .enter()
         .append("text")
         .text(function(d) {
            return d;
         })
         .attr("text-anchor", "middle")
         .attr("x", function(d, i) {
            return i * (w / dataset.length) + (w / dataset.length - barPadding) / 2;
         })
         .attr("y", function(d) {
            return h - (d * 4) + 14;
         })
         .attr("font-family", "sans-serif")
         .attr("font-size", "11px")
         .attr("fill", "white");
  }
</script>
<!-- ---------------------- -->



<div>
  <img src="https://www.svgrepo.com/show/324066/upload.svg" width="128">
</div>


<h3>Making a Scatterplot</h3>

<p>

<!--
So far, we’ve drawn only bar charts with simple data—just one-dimensional sets of
numbers.
-->

But when you have <span style="color:red">two sets of values</span> to plot against each other, you need a <span style="color:red">second dimension</span>. 


The <span style="color:red">scatterplot</span> is a common type of visualization that represents two sets of corresponding values on <span style="color:red">two different axes</span>: horizontal and vertical, x and y.
</p>




<h3>The Data</h3>

<p>
<!--
  As you saw in Chapter 3, you have a lot of flexibility around how to structure a dataset.
-->

For our scatterplot, I’m going to use <span style="color:red">an array of arrays</span>. 

<!--
The primary array will contain one element for each data “point.” 

Each of those “point” elements will be another array, with just two values: one for the x value, and one for y:
-->
</p>

<div>
  <textarea rows="6" cols="100">
var dataset = [
                [5, 20], [480, 90], [250, 50], [100, 33], [330, 95],
                [410, 12], [475, 44], [25, 67], [85, 21], [220, 88]
              ];
  </textarea>
</div>



<div>
  <img src="https://www.svgrepo.com/show/324045/proc.svg" width="128">
</div>

<!--
<p>
  Remember, <span style="color:red">[ ]</span> means array, so nested hard brackets [[]] indicate an array within another array. We separate array elements with commas, so an array containing three other arrays would look like this: [[],[],[]].
</p>
-->

<p>
We could rewrite our dataset with more <span style="color:red">whitespace</span> so it’s easier to read:
</p>

<div>
  <textarea rows="14" cols="100">
var dataset = [
                [ 5, 20 ],
                [ 480, 90 ],
                [ 250, 50 ],
                [ 100, 33 ],
                [ 330, 95 ],
                [ 410, 12 ],
                [ 475, 44 ],
                [ 25, 67 ],
                [ 85, 21 ],
                [ 220, 88 ]
              ];
  </textarea>
</div>

<p>
Now you can see that each of these 10 rows will correspond to one point in our visualization.
<br><br>
With the row <span style="color:red">[5, 20]</span>, for example, we’ll use 5 as the x value, and 20 for the y.
</p>



<h3>The Scatterplot</h3>

<p>
  Let’s carry over most of the code from our bar chart experiments, including the piece
that creates the SVG element:
</p>

<div>
  <textarea rows="6" cols="100">
//Create SVG element
var svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h);
  </textarea>
</div>


<div>
  <img src="" width="128">
</div>


<p>
  Instead of creating <span style="color:red">rects</span>, however, we’ll make a <span style="color:red">circle</span> for each data point:
</p>

<div>
  <textarea rows="6" cols="100">
svg.selectAll("circle") // <-- No longer "rect"
    .data(dataset)
    .enter()
    .append("circle") // <-- No longer "rect"
  </textarea>
</div>


<p>
  Also, instead of specifying the <span style="color:red">rect</span> attributes of <span style="color:red">x</span>, <span style="color:red">y</span>, <span style="color:red">width</span>, and <span style="color:red">height</span>, 

  <br><br>our <span style="color:red">circles</span> need <span style="color:red">cx</span>, <span style="color:red">cy</span>, and <span style="color:red">r</span>:
</p>

<div>
  <textarea rows="8" cols="100">
.attr("cx", function(d) {
  return d[0];
})
.attr("cy", function(d) {
  return d[1];
})
.attr("r", 5);
  </textarea>
</div>

<p>
See the working <span style="color:red">scatterplot</span> code that recreates the result shown in Figure 6-32 in <span style="color:red">22_scatterplot.html</span>.
</p>




<div>
  <img src="https://www.svgrepo.com/show/324006/gas.svg" width="128">
</div>



<!-- ---------------------- -->
<div>
  D3: A simple scatterplot with SVG
  <div id="demo0622"></div>
  Figure 6-32. Simple scatterplot
  <hr>
  <button onclick="myFunction0622()">chapter_06/22_scatterplot.html</button>
  <hr>
  <textarea rows="30" cols="100">

//Width and height
var w = 500;
var h = 100;

var dataset = [
        [5, 20], [480, 90], [250, 50], [100, 33], [330, 95],
        [410, 12], [475, 44], [25, 67], [85, 21], [220, 88]
        ];

//Create SVG element
var svg = d3.select("#demo0622")
      .append("svg")
      .attr("width", w)
      .attr("height", h);

svg.selectAll("circle")
   .data(dataset)
   .enter()
   .append("circle")
   .attr("cx", function(d) {
      return d[0];
   })
   .attr("cy", function(d) {
      return d[1];
   })
   .attr("r", 5);
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0622() {
      //Width and height
      var w = 500;
      var h = 100;
      
      var dataset = [
              [5, 20], [480, 90], [250, 50], [100, 33], [330, 95],
              [410, 12], [475, 44], [25, 67], [85, 21], [220, 88]
              ];
  
      //Create SVG element
      var svg = d3.select("#demo0622")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("circle")
         .data(dataset)
         .enter()
         .append("circle")
         .attr("cx", function(d) {
            return d[0];
         })
         .attr("cy", function(d) {
            return d[1];
         })
         .attr("r", 5);
  }
</script>
<!-- ---------------------- -->



<p>
<!--
Notice how we access the data values and use them for the cx and cy values. 
-->

When using function(d), D3 automatically hands off the current data value as d to your function. 

<br><br>
In this case, the <span style="color:red">current data value</span> is one of the smaller <span style="color:red">subarrays</span> in our larger dataset array.

<!--
<br><br>

When each single datum d is itself an array of values (and not just a single value, like 3.14159), you need to use bracket notation to access its values. Hence, instead of
return d, we use return d[0] and return d[1], which return the first and second
values of the array, respectively.
-->

<br><br>
For example, in the case of our first data point [5, 20], the first value (array position 0) is 5, and the second value (array position 1) is 20. Thus:
</p>

<div>
  <textarea rows="3" cols="100">
d[0] // returns 5
d[1] // returns 20
  </textarea>
</div>


<div>
  <img src="https://www.svgrepo.com/show/324008/gas-electric.svg" width="128">
</div>



<p>
By the way, if you ever want to access any value in the larger dataset (outside of D3,
say), you can do so using bracket notation. For example:
</p>

<div>
  <textarea rows="3" cols="100">
dataset[5] // returns [410, 12]
  </textarea>
</div>



<p>
You can even use multiple sets of brackets to access values within nested arrays:
</p>

<div>
  <textarea rows="3" cols="100">
dataset[5][1] // returns 12
  </textarea>
</div>


<p>
<!--
Don’t believe me? 
-->

Take another look at the scatterplot page <span style="color:red">22_scatterplot.html</span>, open your JavaScript console, type in <span style="color:red">dataset[5]</span> or <span style="color:red">dataset[5][1]</span>, and see what happens.
</p>



<div>
  <img src="https://www.svgrepo.com/show/324015/handdrops.svg" width="128">
</div>


<h3>Size</h3>

<p>
  <!--
Maybe you want the circles to be different sizes, so each circle’s area corresponds to its
y value. 
-->

As a general rule, when visualizing quantitative values with circles, make sure
to encode the values as <span style="color:red">area</span>, not as a circle’s <span style="color:red">radius</span>. 

<!--
Perceptually, humans interpret the overall amount of “ink” or pixels (the area) to reflect the data value. 

A common mistake is to map the value to the radius, which would vastly overrepresent the data and distort the relative relationship between values. 

(For that matter, humans are not so great at accurately comparing areas, either, but that’s another discussion.) 
-->

Mapping to the <span style="color:red">radius</span> is easier to do, as it requires less math, but the result will visually distort your data.

</p>


<div>
  <img src="https://www.svgrepo.com/show/324010/glasses-ecology.svg" width="128">
</div>

<!--

<p>
Yet when creating SVG circles, we can’t specify an area value; we have to calculate the
radius r and then set that. So, starting with a data value as area, how do we get to a
radius value?
</p>

<p>
You might remember that the area of a circle equals π times the radius squared, or A = πr2.
</p>

<p>
To solve for r, we can rework the equation like so:
</p>
<p>

r = sqrt ( A / π )

</p>



<p>
For us, the area of each circle is driven by a data value—d[1], in this case. Actually,
let’s subtract that value from h, so the circles at the top are larger. 

So our area value A is h - d[1]. We could update our equation as pseudocode as follows:
</p>

<p>
r = sqrt ( ( h - d[1] ) / π )
  </textarea>
</p>

-->

<div>
  <img src="https://www.svgrepo.com/show/323998/flower2.svg" width="128">
</div>


<p>
The D3 code equivalent is:
</p>

<div>
  <textarea rows="4" cols="100">
.attr("r", function(d) {
  return Math.sqrt( (h - d[1]) / Math.PI );
});
  </textarea>
</div>


<p>
That said, we can actually omit the pi part, resulting in the simpler:
</p>

<div>
  <textarea rows="4" cols="100">
.attr("r", function(d) {
  return Math.sqrt(h - d[1]);
});
  </textarea>
</div>


<p>
  <!--
What matters here is not the actual circle areas, but the relative areas. 

The actual areas will vary greatly, anyway, when your chart is viewed on
different devices and displays. 

For purposes of honest visual representation, dividing
by pi is not necessary; it has the effect of simply making all circles equally smaller.
-->

See <span style="color:red">23_scatterplot_sqrt.html</span> for the code that results in the scatterplot shown in Figure 6-33.
</p>


<!-- ---------------------- -->
<div>
  D3: A simple scatterplot, setting radii from data
  <div id="demo0623"></div>
  Figure 6-33. Scatterplot with sized circles (點越高，其面積越大)
  <hr>
  <button onclick="myFunction0623()">chapter_06/23_scatterplot_sqrt.html</button>
  <hr>
  <textarea rows="28" cols="100">

//Width and height
var w = 500;
var h = 100;

var dataset = [
        [5, 20], [480, 90], [250, 50], [100, 33], [330, 95],
        [410, 12], [475, 44], [25, 67], [85, 21], [220, 88]
        ];

//Create SVG element
var svg = d3.select("#demo0623")
      .append("svg")
      .attr("width", w)
      .attr("height", h);

svg.selectAll("circle")
   .data(dataset)
   .enter()
   .append("circle")
   .attr("cx", function(d) {
      return d[0];
   })
   .attr("cy", function(d) {
      return d[1];
   })
   .attr("r", function(d) {
      return Math.sqrt(h - d[1]);
   });
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0623() {
      //Width and height
      var w = 500;
      var h = 100;
      
      var dataset = [
              [5, 20], [480, 90], [250, 50], [100, 33], [330, 95],
              [410, 12], [475, 44], [25, 67], [85, 21], [220, 88]
              ];
  
      //Create SVG element
      var svg = d3.select("#demo0623")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("circle")
         .data(dataset)
         .enter()
         .append("circle")
         .attr("cx", function(d) {
            return d[0];
         })
         .attr("cy", function(d) {
            return d[1];
         })
         .attr("r", function(d) {
            return Math.sqrt(h - d[1]);
         });
  }
</script>
<!-- ---------------------- -->


<p>
After arbitrarily subtracting the datum’s y value <span style="color:red">d[1]</span> from the SVG height <span style="color:red">h</span>, and then taking the square root, we see that circles with greater <span style="color:red">y</span> values (those circles lower down) have smaller areas (and shorter radii).

<br><br>

This particular use of circle area as a visualization tool isn’t necessarily useful. 

<!--
I simply want to illustrate how you can use d, along with bracket notation, to reference an individual datum, apply some transformation to that value, and use the newly calculated
value to return a value back to the attribute-setting method (a value used for r,
in this case).
-->
</p>



<div>
  <img src="https://www.svgrepo.com/show/323999/flower.svg" width="128">
</div>


<h3>Labels</h3>

<p>
Let’s label our data points with <span style="color:red">text</span> elements. 
<!--
I’ll adapt the label code from our bar chart experiments, starting with the following:
-->
</p>

<div>
  <textarea rows="6" cols="100">
svg.selectAll("text") // <-- Note "text", not "circle" or "rect"
    .data(dataset)
    .enter()
    .append("text") // <-- Same here!
  </textarea>
</div>


<div>
  <img src="" width="128">
</div>


<p>
This looks for all text elements in the SVG (there aren’t any yet), and then appends a
new text element for each data point. Then we use the <span style="color:red">text()</span> method to specify each element’s contents:
</p>

<div>
  <textarea rows="4" cols="100">
.text(function(d) {
  return d[0] + "," + d[1];
})
  </textarea>
</div>

<!--
<p>

This looks messy, but bear with me. Once again, we’re using function(d) to access
each data point. Then, within the function, we’re using both d[0] and d[1] to get both
values within that data point array.


The plus + symbols, when used with strings, such as the comma between quotation
marks ",", act as append operators. So what this one line of code is really saying is
this: get the values of d[0] and d[1] and smush them together with a comma in the
middle. 

The end result should be something like 5,20 or 25,67.
</p>
-->


<p>
Next, we specify where the <span style="color:red">text</span> should be placed with <span style="color:red">x</span> and <span style="color:red">y</span> values. For now, let’s just use <span style="color:red">d[0]</span> and <span style="color:red">d[1]</span>, the same values that we used to specify the circle positions:
</p>

<div>
  <textarea rows="8" cols="100">
.attr("x", function(d) {
  return d[0];
})
.attr("y", function(d) {
  return d[1];
})
  </textarea>
</div>


<p>Finally, add a bit of font styling with:</p>

<div>
  <textarea rows="4" cols="100">
.attr("font-family", "sans-serif")
.attr("font-size", "11px")
.attr("fill", "red");
  </textarea>
</div>



<p>
The result in <span style="color:red">Figure 6-34</span> might not be pretty, but we got it working! See <span style="color:red">24_scatterplot_labels.html</span> for the latest.
</p>



<!-- ---------------------- -->
<div>
  D3: A simple scatterplot with value labels
  <div id="demo0624"></div>
  Figure 6-34. Scatterplot with labels
  <hr>
  <button onclick="myFunction0624()">chapter_06/24_scatterplot_labels.html</button>
  <hr>
  <textarea rows="48" cols="100">

//Width and height
var w = 550;
var h = 150;

var dataset = [
        [5, 20], [480, 90], [250, 50], [100, 33], [330, 95],
        [410, 12], [475, 44], [25, 67], [85, 21], [220, 88]
        ];

//Create SVG element
var svg = d3.select("#demo0624")
      .append("svg")
      .attr("width", w)
      .attr("height", h);

svg.selectAll("circle")
   .data(dataset)
   .enter()
   .append("circle")
   .attr("cx", function(d) {
      return d[0];
   })
   .attr("cy", function(d) {
      return d[1];
   })
   .attr("r", function(d) {
      return Math.sqrt(h - d[1]);
   });

svg.selectAll("text")
   .data(dataset)
   .enter()
   .append("text")
   .text(function(d) {
      return "(" + d[0] + ", " + d[1] + ")";
   })
   .attr("x", function(d) {
      return d[0] + 15;
   })
   .attr("y", function(d) {
      return d[1] + 3;
   })
   .attr("font-family", "sans-serif")
   .attr("font-size", "11px")
   .attr("fill", "red");
  </textarea>
</div>

<script type="text/javascript">
  function myFunction0624() {
      //Width and height
      var w = 550;
      var h = 150;
      
      var dataset = [
              [5, 20], [480, 90], [250, 50], [100, 33], [330, 95],
              [410, 12], [475, 44], [25, 67], [85, 21], [220, 88]
              ];
  
      //Create SVG element
      var svg = d3.select("#demo0624")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      svg.selectAll("circle")
         .data(dataset)
         .enter()
         .append("circle")
         .attr("cx", function(d) {
            return d[0];
         })
         .attr("cy", function(d) {
            return d[1];
         })
         .attr("r", function(d) {
            return Math.sqrt(h - d[1]);
         });

      svg.selectAll("text")
         .data(dataset)
         .enter()
         .append("text")
         .text(function(d) {
            return "(" + d[0] + ", " + d[1] + ")";
         })
         .attr("x", function(d) {
            return d[0] + 15;
         })
         .attr("y", function(d) {
            return d[1] + 3;
         })
         .attr("font-family", "sans-serif")
         .attr("font-size", "11px")
         .attr("fill", "red");
  }
</script>
<!-- ---------------------- -->


<h3>Next Steps</h3>

<p>
  Hopefully, some core concepts of D3 are becoming clear: 
<br><br>
  <span style="color:red">loading data</span>, 
<br><br>
  <span style="color:red">generating new elements</span>, 
<br><br>
  and using data values to <span style="color:red">derive attribute values</span> for those elements.
</p>


<div>
  <img src="https://www.svgrepo.com/show/324001/flower-colors.svg" width="128">
</div>

<p>
  Yet the image in <span style="color:red">Figure 6-34</span> is barely passable as a data visualization. The scatterplot is hard to read, and the code doesn’t use our data flexibly.
</p>

<!--
<p>
Not to worry: generating a shiny, interactive chart involves taking our D3 skills to the next level. To use data flexibly, we’ll learn about D3’s scales in the next chapter. And to make our scatterplot easier to read, we’ll learn about axis generators and axis labels.
</p>
-->



<!-- ---------------------- -->
<!-- ---------------------- -->

<!--
<iframe frameBorder="0" width="787" height="600" src="https://purecss3.net/index/Gununu_Index_CSS3.html" style="transform: scale(0.5);" scrolling="no"></iframe>
-->

<div onmouseover="playAudio()" onmouseout="pauseAudio()">
<iframe frameBorder="0" width="600" height="300" src="../chapter00/kimetsu.html" style=" transform: scale(2);" scrolling="no"></iframe>
</div>

<!-- 
https://www.w3schools.com/jsref/met_audio_play.asp
https://www.w3schools.com/jsref/event_onmouseover.asp
https://stackoverflow.com/questions/11004437/why-isnt-my-audio-rewinding
-->

<audio id="myAudio">
  <source src="../chapter00/kimetsu.mp3" type="audio/mp3">
</audio>

<script type="text/javascript">
function playAudio() { 
  document.getElementById("myAudio").play(); 
} 

function pauseAudio() { 
  //document.getElementById("myAudio").pause(); 
} 
</script>

<div class="GFG">
終了。 しゅう りょう。 Let's call it a day.
<hr> 
終わりましょう。 Let's get done with this. 
<hr>
終わりにしましょう。 Let's finish this.
</div>

</body>
</html>